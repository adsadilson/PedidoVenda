<ui:composition template="/WEB-INF/template/layout-padrao.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui">

	<ui:define name="titulo">Manutenção de Pedido</ui:define>

	<ui:define name="corpo">

		<script type="text/javascript"> 
	function setfocus(id){
		document.getElementById(id).select()} 
	</script>

		<style type="text/css">
.rotulo {
	width: 140px;
}

.campo {
	width: 300px;
}

.campo100 {
	width: 80%;
}

.botoes {
	float: left;
	width: 10%;
}

.conteudo {
	margin-left: 5%;
}

.ui-panel .ui-panel-content {
	padding: 1px !important;
}
</style>

		<f:metadata>
			<o:viewParam name="codigo" value="#{cadastroPedidoBean.pedido}" />
			<o:viewAction action="#{cadastroPedidoBean.inicializar()}" />
		</f:metadata>

		<h:form prependId="false">
			<h1>#{cadastroPedidoBean.pedido.id != null ? 'Edição de Pedido
				de Produto' : 'Novo Pedido de Produto'}</h1>

			<p:growl autoUpdate="true" />

			<p:wizard flowListener="#{cadastroPedidoBean.onFlowProcess}"
				style="margin-top:20px;">

				<p:tab id="Itens" title="Lançamento de Itens">
					<p:panel header="Relação dos Itens" id="panelItem"
						style="height:385px;">
						<p:dataTable value="#{cadastroPedidoBean.pedido.itens}" var="item"
							rows="8" paginator="true" paginatorAlwaysVisible="false"
							paginatorPosition="bottom"
							paginatorTemplate="{FirstPageLink} {PreviousPageLink} {NextPageLink} 
							{LastPageLink} {RowsPerPageDropdown} {CurrentPageReport} {JumpToPageDropdown}"
							id="tabelaItens">

							<p:column headerText="Código de Barra"
								style="text-align: center; width: 130px">

								<h:outputText value="#{item.produto.codigoBarra}"
									rendered="#{item.produtoAssociado}" />

								<p:inputText style="width:95%;" id="cod" onfocus="select()"
									value="#{cadastroPedidoBean.codigoBarra}" label="Código Barra"
									rendered="#{not item.produtoAssociado}">
									<p:ajax event="change" process="@this"
										update="qtde descricao vlr qtdest"
										oncomplete="setfocus('tabelaItens:0:qtde')"
										listener="#{cadastroPedidoBean.carregarProdutoPesquisado()}" />
								</p:inputText>

							</p:column>
							<p:column headerText="Produto">
								<h:outputText value="#{item.produto.nome}"
									rendered="#{item.produtoAssociado}" />

								<p:autoComplete styleClass="produto-tabela" style="width:98%;"
									value="#{cadastroPedidoBean.produtoLinhaEditavel}"
									completeMethod="#{cadastroPedidoBean.completarProduto}"
									var="produto" itemLabel="#{produto.nome}" id="descricao"
									itemValue="#{produto}" forceSelection="true"
									rendered="#{not item.produtoAssociado}">
									<p:ajax event="itemSelect" update="qtde cod vlr qtdest"
										oncomplete="setfocus('tabelaItens:0:qtde')"
										listener="#{cadastroPedidoBean.carregarProdutoPesquisado()}" />
								</p:autoComplete>
							</p:column>
							<p:column headerText="Valor unitário"
								style="text-align: right; width: 110px">
								<h:outputText value="#{item.produto.vlrVenda}"
									rendered="#{item.produtoAssociado}">
									<f:convertNumber type="currency" />
								</h:outputText>

								<h:outputText id="vlr"
									value="#{cadastroPedidoBean.vlrUnit}" label="Valor unitário"
									rendered="#{not item.produtoAssociado}">
									<f:convertNumber type="currency" />
								</h:outputText>
							</p:column>
							<p:column headerText="Quantidade"
								style="text-align: center; width: 100px">
								<p:inputText id="qtde" size="8" value="#{item.quantidade}">
									<p:ajax event="blur" process="@this" update="tabelaItens"
										listener="#{cadastroPedidoBean.carregarProdutoLinhaEditavel()}" />
								</p:inputText>
								<p:focus for="cod" />
							</p:column>
							<p:column headerText="Estoque"
								style="text-align: center; width: 100px">
								<h:outputText value="#{item.produto.quantidade}"
									rendered="#{item.produtoAssociado}">
									<f:convertNumber type="currency" currencySymbol="" />
								</h:outputText>

								<h:outputText id="qtdest"
									value="#{cadastroPedidoBean.qtdeEstoque}" label="Estoque"
									rendered="#{not item.produtoAssociado}">
									<f:convertNumber type="currency" currencySymbol="" />
								</h:outputText>
							</p:column>

							<p:column headerText="Valor total"
								style="text-align: right; width: 100px">
								<h:outputText value="#{item.valorTotal}">
									<f:convertNumber type="currency" />
								</h:outputText>
							</p:column>

							<p:columnGroup type="footer">
								<p:row>
									<p:column colspan="5" footerText="Subtotal"
										style="text-align: right" />
									<p:column footerText="R$ 0,00" style="text-align: right" />
								</p:row>
							</p:columnGroup>
						</p:dataTable>
					</p:panel>
				</p:tab>
				<p:tab id="DdCliente" title="Dados do Fechamento">
					<p:panel header="Informação p/Fechamento" style="height:365px;">
						<p:toolbar style="margin-top: 20px" styleClass="semPreenchimento">
							<p:toolbarGroup>
								<p:commandButton value="Salvar" id="botaoSalvar"
									icon="fa fa-save" action="#{cadastroPedidoBean.salvar}"
									update="panelEndereco panelObs" />
								<p:button value="Limpar" icon="fa fa-eraser"
									style="margin-left:3px; margin-right:3px;"
									outcome="/pages/cadastros/pedido/cadastroPedido" />
								<p:button value="Voltar" icon="fa fa-refresh"
									outcome="/pages/cadastros/pedido/listaPedido" />
							</p:toolbarGroup>
							<p:toolbarGroup align="right">
								<p:button value="Fechar" outcome="/home" />
							</p:toolbarGroup>
						</p:toolbar>

						<p:tabView style="margin-top: 10px; height: 230px;"
							prependId="false">
							<p:tab title="informativo">
							</p:tab>
							<p:tab title="Dados de entrega">
								<h:panelGrid columns="2" id="panelEndereco"
									style="margin-top:20px; margin-left:10px;"
									columnClasses="rotulo,campo100">

									<p:outputLabel value="Data Entrega" for="dtEntrega" />
									<p:calendar id="dtEntrega" required="true" pattern="dd/MM/yyyy"
										requiredMessage="O campo 'DATA ENTREGA' é obrigatório."
										value="#{cadastroPedidoBean.pedido.dataEntrega}">
									</p:calendar>

									<p:outputLabel value="CEP" for="cep" />
									<p:inputMask mask="99999-999" id="cep" required="true"
										requiredMessage="O campo 'CEP' é obrigatório."
										value="#{cadastroPedidoBean.pedido.enderecoEntrega.cep}" />

									<p:outputLabel value="Logradouro" for="logradouro" />
									<h:panelGroup>
										<p:inputText id="logradouro" style="width: 60%"
											required="true"
											requiredMessage="O campo 'LOGRADOURO' é obrigatório."
											value="#{cadastroPedidoBean.pedido.enderecoEntrega.logradouro}" />
										<p:inputText id="numero" style="width: 10%; margin-left:5px;"
											value="#{cadastroPedidoBean.pedido.enderecoEntrega.numero}" />
									</h:panelGroup>

									<p:outputLabel value="Complemento" for="complemento" />
									<h:panelGroup>
										<p:inputText id="complemento"
											value="#{cadastroPedidoBean.pedido.enderecoEntrega.complemento}" />
										<p:outputLabel value="Bairro" for="bairro"
											style="margin-left: 10px; margin-right:12px;" />
										<p:inputText id="bairro" required="true"
											requiredMessage="O campo 'BAIRRO' é obrigatório."
											value="#{cadastroPedidoBean.pedido.enderecoEntrega.bairro}" />
									</h:panelGroup>

									<p:outputLabel value="UF" for="uf" />
									<h:panelGroup>
										<p:selectOneMenu id="uf" required="true" style="width:150px;"
											requiredMessage="O campo 'UF' é obrigatório."
											value="#{cadastroPedidoBean.pedido.enderecoEntrega.uf}">
											<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
											<f:selectItems value="#{cadastroPedidoBean.estados}" var="uf"
												itemLabel="#{uf.sigla}" itemValue="#{uf}" />
											<p:ajax event="change"
												listener="#{cadastroPedidoBean.carregarCidadesPorEstados}"
												update="comboCidade" />
										</p:selectOneMenu>
										<p:outputLabel value="Cidade" for="comboCidade"
											style="margin-left: 10px; margin-right:5px;" />
										<p:selectOneMenu autoWidth="false" filter="true"
											value="#{cadastroPedidoBean.pedido.enderecoEntrega.cidade}"
											id="comboCidade" required="true" style="width:150px;"
											requiredMessage="O campo 'CIDADE' é obrigatório.">
											<f:selectItem itemLabel="Selecione..." itemValue="#{null}" />
											<f:selectItems value="#{cadastroPedidoBean.cidades}"
												var="cidade" itemLabel="#{cidade.nome}"
												itemValue="#{cidade}" />
										</p:selectOneMenu>
									</h:panelGroup>
								</h:panelGrid>
							</p:tab>
							<p:tab title="Observação">
								<h:panelGroup id="panelObs" layout="block"
									style="padding-right: 10px">
									<p:inputTextarea rows="12"
										style="width: 100%; text-transform: uppercase;"
										value="#{cadastroPedidoBean.pedido.observacao}" />
								</h:panelGroup>
							</p:tab>
						</p:tabView>

					</p:panel>
				</p:tab>
			</p:wizard>


		</h:form>

	</ui:define>
</ui:composition>